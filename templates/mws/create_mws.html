{% extends "shared/base.html" %} {% block title %}Buat MWS Baru - Sistem Aircraft Maintenance{% endblock %} {% block content %}
<div class="min-h-screen bg-gray-50">
  <div class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center py-4">
        <a href="{{ url_for('dashboard') }}" class="mr-4 p-2 hover:bg-gray-100 rounded-lg transition-colors">
          <i class="fas fa-arrow-left text-gray-600"></i>
        </a>
        <div>
          <h1 class="text-2xl font-bold text-gray-800">Buat MWS Baru</h1>
          <p class="text-gray-600">Maintenance Work Sheet</p>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
      <form id="createMwsForm" class="space-y-8">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <fieldset>
          <legend class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-6 w-full">Informasi Part Utama</legend>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Part Number *</label><input type="text" name="partNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: AOA-001" />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Serial Number *</label><input type="text" name="serialNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: SN123456" />
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Tittle *</label
              ><input type="text" name="tittle_name" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: Angle of Attack Indicator" />
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-6 w-full">Detail & Referensi Pekerjaan</legend>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Ref (Referensi) *</label><input type="text" name="ref" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: CMM 34-12-24" />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Jenis Pekerjaan *</label>
              <select name="jobType" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required>
                <option value="" disabled selected>Pilih jenis pekerjaan</option>
                <option value="F.Test">F.Test</option>
                <option value="Repair">Repair</option>
                <option value="Overhaul">Overhaul</option>
                <option value="IRAN">IRAN</option>
                <option value="Recharging">Recharging</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Customer *</label><input type="text" name="customer" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: Garuda Indonesia" />
            </div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-2">A/C Type *</label><input type="text" name="acType" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: CN235" /></div>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-6 w-full">Informasi Administrasi</legend>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">WBS No. *</label
              ><input type="text" name="wbsNo" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: A/S90-025CN235-90-99-99" />
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Worksheet No. *</label><input type="text" name="worksheetNo" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: IN-108" />
            </div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-2">IWO No. *</label><input type="text" name="iwoNo" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: Z501-00001" /></div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-2">Shop Area *</label><input type="text" name="shopArea" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required placeholder="Contoh: IN" /></div>
          </div>
        </fieldset>

        <fieldset>
          <legend class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-6 w-full">Tanggal & Revisi</legend>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div><label class="block text-sm font-semibold text-gray-700 mb-2">Target Date *</label><input type="date" name="targetDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required /></div>
            <div><label class="block text-sm font-semibold text-gray-700 mb-2">Revision</label><input type="text" name="revision" class="w-full px-4 py-3 border border-gray-300 rounded-lg" value="1" /></div>
          </div>
        </fieldset>

        <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200 mt-8">
          <a href="{{ url_for('dashboard') }}" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium">Batal</a>
          <button type="submit" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium"><i class="fas fa-plus mr-2"></i>Buat MWS</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function showNotification(message, type) {
    const notification = document.createElement("div");
    notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-50 ${type === "success" ? "bg-green-500" : "bg-red-500"}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  document.getElementById("createMwsForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const formData = new FormData(this);
    const data = {};
    for (let [key, value] of formData.entries()) {
      if (key !== "csrf_token") {
        data[key] = value;
      }
    }
    data.tittle = formData.get("tittle_name");
    data.jobType = formData.get("jobType");

    // [DIPERBARUI] Mengambil token dari input yang benar
    const csrfToken = document.querySelector('input[name="csrf_token"]').value;

    fetch("/create_mws", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrfToken,
      },
      body: JSON.stringify(data),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          showNotification("MWS berhasil dibuat!", "success");
          setTimeout(() => {
            window.location.href = "/mws/" + data.partId;
          }, 1000);
        } else {
          showNotification("Error membuat MWS: " + data.error, "error");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        showNotification("Error membuat MWS", "error");
      });
  });
</script>
{% endblock %}
